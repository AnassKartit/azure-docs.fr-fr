---
title: Résoudre les erreurs liées au volume pour Azure NetApp Files | Microsoft Docs
description: Décrit les messages d’erreur et les résolutions qui peuvent vous aider à résoudre les problèmes avec les volumes Azure NetApp Files.
services: azure-netapp-files
documentationcenter: ''
author: b-juche
manager: ''
editor: ''
ms.assetid: ''
ms.service: azure-netapp-files
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: troubleshooting
ms.date: 10/04/2021
ms.author: b-juche
ms.openlocfilehash: f46b6f0c0648dcc354f170548a4273188c4871e6
ms.sourcegitcommit: 692382974e1ac868a2672b67af2d33e593c91d60
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/22/2021
ms.locfileid: "130219732"
---
# <a name="troubleshoot-volume-errors-for-azure-netapp-files"></a>Résoudre les erreurs liées au volume pour Azure NetApp Files

Cet article décrit les messages d’erreur et les résolutions qui peuvent vous aider à résoudre les problèmes de double protocole pour Azure NetApp Files. 

## <a name="errors-for-smb-and-dual-protocol-volumes"></a>Erreurs pour les volumes SMB et double protocole

|     Conditions d’erreur    |     Résolutions    |
|-|-|
| La création du volume SMB ou double protocole échoue avec l’erreur suivante : <br> `{"code":"DeploymentFailed","message":"At least one resource deployment operation failed. Please list deployment operations for details. Please see https://aka.ms/DeployOperations for usage details.","details":[{"code":"InternalServerError", "message":"Error when creating - Could not query DNS server. Verify that the network configuration is correct and that DNS servers are available."}]}` | Cette erreur indique que le DNS n’est pas accessible. <br> Envisagez les solutions suivantes : <ul><li>Vérifiez si AD DS et le volume sont déployés dans la même région.</li> <li>Vérifiez si AD DS et le volume utilisent le même réseau virtuel. S’ils utilisent des réseaux virtuels différents, assurez-vous que ceux-ci sont appairés. Consultez [Consignes pour planifier un réseau Azure NetApp Files](azure-netapp-files-network-topologies.md). </li> <li>Des groupes de sécurité réseau (NSG) peuvent être appliqués au serveur DNS.  Celui-ci n’autorise alors pas le trafic à circuler. Dans ce cas, ouvrez les groupes NSG sur le service DNS ou AD pour vous connecter à différents ports. Pour connaître les exigences liées aux ports, consultez [Prérequis des connexions Active Directory](create-active-directory-connections.md#requirements-for-active-directory-connections). </li></ul> <br>Les mêmes solutions s’appliquent à Azure AD DS. Azure AD DS doit être déployé dans la même région. Le réseau virtuel doit se trouver dans la même région ou être appairé avec le réseau virtuel utilisé par le volume. | 
| La création du volume SMB ou double protocole échoue avec l’erreur suivante : <br> `{"code":"DeploymentFailed","message":"At least one resource deployment operation failed. Please list deployment operations for details. Please see https://aka.ms/DeployOperations for usage details.","details":[{"code":"InternalServerError", "message":"Error when creating - Failed to create the Active Directory machine account \"SMBTESTAD-C1C8\". Reason: Kerberos Error: Invalid credentials were given Details: Error: Machine account creation procedure failed\n [ 563] Loaded the preliminary configuration.\n**[ 670] FAILURE: Could not authenticate as 'test@contoso.com':\n** Unknown user (KRB5KDC_ERR_C_PRINCIPAL_UNKNOWN)\n. "}]}`  |  <ul><li>Vérifiez que le nom d’utilisateur entré est correct. </li> <li>Vérifiez que l’utilisateur fait partie du groupe Administrateurs qui dispose du privilège de créer des comptes d’ordinateur. </li> <li> Si vous utilisez Azure AD DS, vérifiez que l’utilisateur fait partie du groupe Azure AD `Azure AD DC Administrators`. </li></ul> | 
| La création du volume SMB ou double protocole échoue avec l’erreur suivante : <br> `{"code":"DeploymentFailed","message":"At least one resource deployment operation failed. Please list deployment operations for details. Please see https://aka.ms/DeployOperations for usage details.","details":[{"code":"InternalServerError", "message":"Error when creating - Failed to create the Active Directory machine account \"SMBTESTAD-A452\". Reason: Kerberos Error: Pre-authentication information was invalid Details: Error: Machine account creation procedure failed\n [ 567] Loaded the preliminary configuration.\n [ 671] Successfully connected to ip 10.x.x.x, port 88 using TCP\n**[ 1099] FAILURE: Could not authenticate as\n** 'user@contoso.com': CIFS server account password does\n** not match password stored in Active Directory\n** (KRB5KDC_ERR_PREAUTH_FAILED)\n. "}]}` | Vérifiez que le mot de passe entré pour rejoindre la connexion AD est correct. |
| La création du volume SMB ou double protocole échoue avec l’erreur suivante : <br> `{"code":"DeploymentFailed","message":"At least one resource deployment operation failed. Please list deployment operations for details. Please see https://aka.ms/DeployOperations for usage details.","details":[{"code":"InternalServerError","message":"Error when creating - Failed to create the Active Directory machine account \"SMBTESTAD-D9A2\". Reason: SecD Error: ou not found Details: Error: Machine account creation procedure failed\n [ 561] Loaded the preliminary configuration.\n [ 665] Successfully connected to ip 10.x.x.x, port 88 using TCP\n [ 1039] Successfully connected to ip 10.x.x.x, port 389 using TCP\n**[ 1147] FAILURE: Specifed OU 'OU=AADDC Com' does not exist in\n** contoso.com\n. "}]}` | Vérifiez que le chemin d’UO spécifié pour rejoindre la connexion AD est correct. Si vous utilisez Azure AD DS, assurez-vous que le chemin de l’unité d’organisation est `OU=AADDC Computers`. |
| La création du volume SMB ou double protocole échoue avec l’erreur suivante : <br> `Failed to create the Active Directory machine account \"SMB-ANF-VOL. Reason: LDAP Error: Local error occurred Details: Error: Machine account creation procedure failed. [nnn] Loaded the preliminary configuration. [nnn] Successfully connected to ip 10.x.x.x, port 88 using TCP [nnn] Successfully connected to ip 10.x.x.x, port 389 using [nnn] Entry for host-address: 10.x.x.x not found in the current source: FILES. Ignoring and trying next available source [nnn] Source: DNS unavailable. Entry for host-address:10.x.x.x found in any of the available sources\n*[nnn] FAILURE: Unable to SASL bind to LDAP server using GSSAPI: local error [nnn] Additional info: SASL(-1): generic failure: GSSAPI Error: Unspecified GSS failure. Minor code may provide more information (Cannot determine realm for numeric host address) [nnn] Unable to connect to LDAP (Active Directory) service on contoso.com (Error: Local error) [nnn] Unable to make a connection (LDAP (Active Directory):contosa.com, result: 7643. `  | L’enregistrement du pointeur (PTR) de l’ordinateur hôte AD est peut-être manquant sur le serveur DNS. Vous devez créer une zone de recherche inversée sur le serveur DNS, puis ajouter un enregistrement PTR de l’ordinateur hôte AD dans cette zone de recherche inversée. <br> Par exemple, supposons que l’adresse IP de l’ordinateur AD est `10.x.x.x`, le nom d’hôte de l’ordinateur AD (trouvé à l’aide de la commande `hostname`) est `AD1` et le nom de domaine est `contoso.com`.  L’enregistrement PTR ajouté à la zone de recherche inversée doit être `10.x.x.x` -> `contoso.com`.   | 
| La création du volume SMB ou double protocole échoue avec l’erreur suivante : <br> `Failed to create the Active Directory machine account \"SMB-ANF-VOL\". Reason: Kerberos Error: KDC has no support for encryption type Details: Error: Machine account creation procedure failed [nnn]Loaded the preliminary configuration. [nnn]Successfully connected to ip 10.x.x.x, port 88 using TCP [nnn]FAILURE: Could not authenticate as 'contosa.com': KDC has no support for encryption type  (KRB5KDC_ERR_ETYPE_NOSUPP) ` | Assurez-vous que le [chiffrement AES](./create-active-directory-connections.md#create-an-active-directory-connection) est activé à la fois dans la connexion Active Directory et pour le compte de service. |
| La création du volume SMB ou double protocole échoue avec l’erreur suivante : <br> `Failed to create the Active Directory machine account \"SMB-NTAP-VOL\". Reason: LDAP Error: Strong authentication is required Details: Error: Machine account creation procedure failed\n [ 338] Loaded the preliminary configuration.\n [ nnn] Successfully connected to ip 10.x.x.x, port 88 using TCP\n [ nnn ] Successfully connected to ip 10.x.x.x, port 389 using TCP\n [ 765] Unable to connect to LDAP (Active Directory) service on\n dc51.area51.com (Error: Strong(er) authentication\n required)\n*[ nnn] FAILURE: Unable to make a connection (LDAP (Active\n* Directory):contoso.com), result: 7609\n. "` | L’option de signature LDAP n’est pas sélectionnée, mais le client AD a une signature LDAP.  [Activez la signature LDAP](create-active-directory-connections.md#create-an-active-directory-connection) et réessayez. | 

## <a name="errors-for-dual-protocol-volumes"></a>Erreurs pour les volumes double protocole

|     Conditions d’erreur    |     Résolutions    |
|-|-|
| Le protocole LDAP sur TLS est activé et la création d’un volume à deux protocoles échoue avec l’erreur `This Active Directory has no Server root CA Certificate`.    |     Si cette erreur se produit lorsque vous créez un volume à deux protocoles, assurez-vous que le certificat racine de l’autorité de certification est chargé dans votre compte NetApp.    |
| La création d’un volume à deux protocoles échoue avec l’erreur `Failed to validate LDAP configuration, try again after correcting LDAP configuration`.    |  L’enregistrement du pointeur (PTR) de l’ordinateur hôte AD est peut-être manquant sur le serveur DNS. Vous devez créer une zone de recherche inversée sur le serveur DNS, puis ajouter un enregistrement PTR de l’ordinateur hôte AD dans cette zone de recherche inversée. <br> Par exemple, supposons que l’adresse IP de l’ordinateur AD est `10.x.x.x`, le nom d’hôte de l’ordinateur AD (trouvé à l’aide de la commande `hostname`) est `AD1` et le nom de domaine est `contoso.com`.  L’enregistrement PTR ajouté à la zone de recherche inversée doit être `10.x.x.x` -> `contoso.com`.   |
| La création d’un volume à deux protocoles échoue avec l’erreur `Failed to create the Active Directory machine account \\\"TESTAD-C8DD\\\". Reason: Kerberos Error: Pre-authentication information was invalid Details: Error: Machine account creation procedure failed\\n [ 434] Loaded the preliminary configuration.\\n [ 537] Successfully connected to ip 10.x.x.x, port 88 using TCP\\n**[ 950] FAILURE`. |     Cette erreur indique que le mot de passe AD est incorrect lorsqu’Active Directory est joint au compte NetApp. Mettez à jour la connexion AD avec le mot de passe correct, puis réessayez. |
| La création d’un volume à deux protocoles échoue avec l’erreur `Could not query DNS server. Verify that the network configuration is correct and that DNS servers are available`. |   Cette erreur indique que DNS n’est pas accessible. Cela peut être dû au fait que l’adresse IP DNS est incorrecte ou qu’il y a un problème réseau. Vérifiez l’adresse IP DNS entrée dans la connexion AD et assurez-vous que l’adresse IP est correcte. <br> En outre, assurez-vous que l’instance AD et le volume se trouvent dans la même région et dans le même réseau virtuel. S’ils se trouvent dans des réseaux virtuels différents, assurez-vous que l’appairage de réseaux virtuels est établi entre les deux réseaux virtuels. <br> Voir [Consignes pour planifier un réseau Azure NetApp Files](azure-netapp-files-network-topologies.md#azure-native-environments) pour plus de détails. |
| Erreur « Autorisation refusée » lors du montage d’un volume à deux protocoles. | Un volume à double protocoles prend en charge les protocoles NFS et SMB.  Lorsque vous tentez d’accéder au volume monté sur le système UNIX, celui-ci tente de mapper l’utilisateur UNIX que vous utilisez à un utilisateur Windows. Si aucun mappage n’est trouvé, l’erreur « Autorisation refusée » se produit. <br> Cette situation s’applique également lorsque vous utilisez l’utilisateur « racine » pour l’accès. <br> Pour éviter l’erreur « Autorisation refusée », assurez-vous que Windows Active Directory inclut `pcuser` avant d’accéder au point de montage. Si vous ajoutez `pcuser` après avoir rencontré l’erreur « Autorisation refusée », patientez 24 heures jusqu’à ce que l’entrée du cache s’efface avant de réessayer d’accéder. |

## <a name="errors-for-nfsv41-kerberos-volumes"></a>Erreurs pour les volumes Kerberos NFSv4.1

|     Conditions d’erreur    |     Résolutions    |
|-|-|
|`Error allocating volume - Export policy rules does not match kerberosEnabled flag` | Azure NetApp Files ne prend pas en charge Kerberos pour les volumes NFSv3. Kerberos est uniquement pris en charge pour le protocole NFSv4.1.  |
|`This NetApp account has no configured Active Directory   connections`  |  Configurez Active Directory pour le compte NetApp avec des champs **IP KDC** et **Nom du serveur AD**. Pour obtenir des instructions, consultez [Configurer le portail Azure](configure-kerberos-encryption.md#configure-the-azure-portal). |
|`Mismatch between KerberosEnabled flag value and ExportPolicyRule's access type parameter values.`  | Azure NetApp Files ne prend pas en charge la conversion d’un volume brut NFSv 4.1 en volume Kerberos NFSv 4.1, et inversement. |
|`mount.nfs: access denied by server when mounting volume <SMB_SERVER_NAME-XXX.DOMAIN_NAME>/<VOLUME_NAME>` <br>  Exemple : `smb-test-64d9.contoso.com:/nfs41-vol101` | <ol><li> Assurez-vous que les enregistrements A/PTR sont correctement configurés et présents dans Active Directory pour le nom du serveur `smb-test-64d9.contoso.com`. <br> Dans le client NFS, si `nslookup` pour `smb-test-64d9.contoso.com` correspond à l’adresse IP IP1 (à savoir, `10.1.1.68`), `nslookup` pour IP1 doit correspondre à un seul enregistrement (à savoir, `smb-test-64d9.contoso.com`). `nslookup` pour IP1 ne *doit* pas correspondre à plusieurs noms. </li>  <li>Définissez AES-256 pour le compte d’ordinateur NFS de type `NFS-<Smb NETBIOS NAME>-<few random characters>` sur AD à l’aide de PowerShell ou de l’interface utilisateur. <br> Exemples de commandes : <ul><li>`Set-ADComputer <NFS_MACHINE_ACCOUNT_NAME> -KerberosEncryptionType AES256` </li><li>`Set-ADComputer NFS-SMB-TEST-64 -KerberosEncryptionType AES256` </li></ul> </li> <li>Veillez à ce que l’heure du client NFS, d’AD et du logiciel de stockage Azure NetApp Files soit synchronisée et se situe dans un intervalle de cinq minutes. </li>  <li>Récupérez le ticket Kerberos sur le client NFS à l’aide de la commande `kinit <administrator>`.</li> <li>Réduisez le nom d’hôte du client NFS à moins de 15 caractères et effectuez une nouvelle jonction de domaine. </li><li>Redémarrez le client NFS et le service `rpcgssd` comme suit. La commande peut varier selon le système d’exploitation.<br> RHEL 7 : <br> `service nfs restart` <br> `service rpcgssd restart` <br> CentOS 8 : <br> `systemctl enable nfs-client.target && systemctl start nfs-client.target` <br> Ubuntu : <br> (Redémarrez le service `rpc-gssd`.) <br> `sudo systemctl start rpc-gssd.service` </ul>| 
|`mount.nfs: an incorrect mount option was specified`   | Le problème peut être lié au problème du client NFS. Redémarrez le client NFS.    |
|`Hostname lookup failed`   | Vous devez créer une zone de recherche inversée sur le serveur DNS, puis ajouter un enregistrement PTR de l’ordinateur hôte AD dans cette zone de recherche inversée. <br> Par exemple, supposons que l’adresse IP de l’ordinateur AD est `10.1.1.4`, le nom d’hôte de l’ordinateur AD (trouvé à l’aide de la commande hostname) est `AD1` et le nom de domaine `contoso.com`. L’enregistrement PTR ajouté à la zone de recherche inversée doit être `10.1.1.4 -> AD1.contoso.com`. |
|`Volume creation fails due to unreachable DNS server`  | Deux solutions sont disponibles : <br> <ul><li> Cette erreur indique que DNS n’est pas accessible. Il peut s’agir d’une adresse IP DNS incorrecte ou d’un problème de réseau. Vérifiez l’adresse IP DNS entrée dans la connexion AD et assurez-vous que l’adresse IP est correcte. </li> <li> Assurez-vous que l’instance AD et le volume se trouvent dans la même région et dans le même réseau virtuel. S’ils se trouvent dans des réseaux virtuels différents, assurez-vous que le peering de réseaux virtuels est établi entre les deux réseaux virtuels. </li></ul> |
|La création du volume Kerberos NFSv 4.1 échoue avec une erreur similaire à l’exemple suivant : <br> `Failed to enable NFS Kerberos on LIF "svm_e719cde8d6d0413fbd6adac0636cdecb_7ad0b82e_73349613". Failed to bind service principal name on LIF "svm_e719cde8d6d0413fbd6adac0636cdecb_7ad0b82e_73349613". SecD Error: server create fail join user auth.` |L’adresse IP du KDC est incorrecte et le volume Kerberos a été créé. Mettez à jour l’adresse IP du KDC avec une adresse correcte. <br> Une fois l’adresse IP du KDC mise à jour, l’erreur ne disparaît pas. Vous devez recréer le volume. |

## <a name="errors-for-ldap-volumes"></a>Erreurs pour les volumes LDAP

|     Conditions d’erreur    |     Résolutions    |
|-|-|
| Erreur lors de la création d’un volume SMB avec la valeur ldapEnabled définie sur true : <br> `Error Message: ldapEnabled option is only supported with NFS protocol volume. ` | Vous ne pouvez pas créer un volume SMB avec LDAP activé. <br> Créez des volumes SMB avec LDAP désactivé. |
| Erreur lors de la mise à jour de la valeur du paramètre ldapEnabled pour un volume existant : <br> `Error Message: ldapEnabled parameter is not allowed to update` |  Vous ne pouvez pas modifier le paramètre de l’option LDAP après avoir créé un volume. <br> Ne mettez pas à jour le paramètre de l’option LDAP sur un volume créé. Pour plus de détails, consultez [Configurer ADDS LDAP avec des groupes étendus pour l’accès au volume NFS](configure-ldap-extended-groups.md). |
| Erreur lors de la création d’un volume NFS avec LDAP activé : <br> `Could not query DNS server` <br> `Sample error message:` <br> `"log": time="2020-10-21 05:04:04.300" level=info msg=Res method=GET url=/v2/Volumes/070d0d72-d82c-c893-8ce3-17894e56cea3  x-correlation-id=9bb9e9fe-abb6-4eb5-a1e4-9e5fbb838813 x-request-id=c8032cb4-2453-05a9-6d61-31ca4a922d85 xresp="200:  {\"created\":\"2020-10-21T05:02:55.000Z\",\"lifeCycleState\":\"error\",\"lifeCycleStateDetails\":\"Error when creating - Could not query DNS server. Verify that the network configuration is correct and that DNS servers are available.\",\"name\":\"smb1\",\"ownerId\ \":\"8c925a51-b913-11e9-b0de-9af5941b8ed0\",\"region\":\"westus2stage\",\"volumeId\":\"070d0d72-d82c-c893-8ce3-` |  Cette erreur se produit parce que le DNS est inaccessible. <br> <ul><li> Vérifiez si vous avez configuré le site approprié (étendue de site) pour Azure NetApp Files. </li><li> La raison pour laquelle le DNS est inaccessible peut être une adresse IP DNS incorrecte ou des problèmes de mise en réseau. Vérifiez l’adresse IP de DNS entrée dans la connexion AD, et assurez-vous qu’elle est correcte. </li><li> Assurez-vous que l’AD et le volume se trouvent dans la même région et dans le même réseau virtuel. S’ils se trouvent dans des réseaux virtuels différents, assurez-vous que le peering de réseaux virtuels est établi entre les deux réseaux virtuels.</li></ul> |
| Erreur lors de la création du volume à partir d’une capture instantanée : <br> `Aggregate does not exist` | Azure NetApp Files ne prend pas en charge l’approvisionnement d’un nouveau volume avec LDAP activé à partir d’une capture instantanée appartenant à un volume avec LDAP désactivé. <br> Essayez de créer un volume avec LDAP désactivé à partir de la capture instantané donnée. |

## <a name="errors-for-volume-allocation"></a>Erreurs pour l’allocation de volume 

Lorsque vous créez un nouveau volume ou redimensionnez un volume existant dans Azure NetApp Files, Microsoft Azure alloue des ressources de stockage et de mise en réseau à votre abonnement. Il est possible que vous rencontriez des échecs d’allocation de ressources en raison d’une augmentation sans précédent de la demande de services Azure dans certaines régions.

Cette section explique les causes de certains échecs d’allocation courants et propose des solutions possibles.

|     Conditions d’erreur    |     Résolutions    |
|-|-|
|Erreur lors de la création de volumes ou du redimensionnement des volumes existants. <br> Message d’erreur : `There was a problem locating [or extending] storage  for the volume. Please retry the operation. If the problem persists, contact Support.` | L’erreur indique que le service a rencontré une erreur lors de la tentative d’allocation de ressources pour cette demande. <br> Réessayez l’opération après un certain temps. Contactez le support si le problème persiste.|
|Capacité de stockage ou de réseau insuffisante dans une région pour les volumes ordinaires. <br> Message d’erreur : `There are currently insufficient resources available to create [or extend] a volume in this region. Please retry the operation. If the problem persists, contact Support.` | L’erreur indique que les ressources disponibles dans la région sont insuffisantes pour créer ou redimensionner des volumes. <br> Essayez l'une des solutions suivantes : <ul><li>Créez le volume sous un nouveau réseau virtuel. Cela permet d’éviter d’atteindre les limites de ressources liées à la mise en réseau.</li> <li>Recommencez l’opération un peu plus tard. Les ressources ont peut-être été libérées dans le cluster, la région ou la zone entretemps.</li></ul> |
|Capacité de stockage insuffisante lors de la création d’un volume avec les fonctionnalités réseau définies sur `Standard`. <br> Message d’erreur : `No storage available with Standard network features, for the provided VNet.` | L’erreur indique que les ressources disponibles dans la région sont insuffisantes pour créer des volumes avec des fonctionnalités de mise en réseau `Standard`. <br> Essayez l'une des solutions suivantes : <ul><li>Si les fonctionnalités réseau `Standard` ne sont pas requises, créez le volume avec les fonctionnalités réseau `Basic`.</li> <li>Essayez de créer le volume sous un nouveau réseau virtuel. Cela permet d’éviter d’atteindre les limites de ressources liées à la mise en réseau</li><li>Recommencez l’opération un peu plus tard.  Les ressources ont peut-être été libérées dans le cluster, la région ou la zone entretemps.</li></ul> |

## <a name="next-steps"></a>Étapes suivantes  

* [Créer un volume NFS pour Azure NetApp Files](azure-netapp-files-create-volumes.md)
* [Créer un volume SMB pour Azure NetApp Files](azure-netapp-files-create-volumes-smb.md) 
* [Créer un volume double protocole pour Azure NetApp Files](create-volumes-dual-protocol.md) 
* [Configurer les fonctionnalités réseau d’un volume](configure-network-features.md)
