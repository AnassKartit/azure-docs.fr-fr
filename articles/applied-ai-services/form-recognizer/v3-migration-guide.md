---
title: 'Guide pratiqueÂ : Migrer votre application de la versionÂ 2.1 Ã  la versionÂ 3.0 de Form Recognizer.'
titleSuffix: Azure Applied AI Services
description: Dans ce guide pratique, vous apprendrez les diffÃ©rences entre la versionÂ 2.1 et la versionÂ 3.0 de lâ€™API Form Recognizer. Vous dÃ©couvrirez Ã©galement les modifications Ã  apporter pour passer Ã  la nouvelle version de lâ€™API.
author: vkurpad
manager: nitinme
ms.service: applied-ai-services
ms.subservice: forms-recognizer
ms.topic: how-to
ms.date: 10/07/2021
ms.author: vikurpad
recommendations: false
ms.openlocfilehash: 11010ebe6a4afa8698491dacfb495625a8445779
ms.sourcegitcommit: 692382974e1ac868a2672b67af2d33e593c91d60
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/22/2021
ms.locfileid: "130240411"
---
# <a name="form-recognizer-v30-migration--preview"></a>Migration Form RecognizerÂ v3.0 | PrÃ©version

> [!IMPORTANT]
>
> La versionÂ 3.0 de lâ€™API REST de Form Recognizer introduit des changements cassants dans la requÃªte de lâ€™API REST et lâ€™analyse de la rÃ©ponse JSON.

Form RecognizerÂ v3.0 (prÃ©version) introduit plusieurs nouvelles fonctionnalitÃ©s et capacitÃ©sÂ :

* Lâ€™[API REST de Form Recognizer](quickstarts/try-v3-rest-api.md) a Ã©tÃ© remaniÃ©e pour une meilleure convivialitÃ©.
* Le modÃ¨le [**Document gÃ©nÃ©ral (v3.0)**](concept-general-document.md) est une nouvelle API qui extrait le texte, les tableaux, la structure, les paires clÃ©-valeur et les entitÃ©s nommÃ©es des formulaires et des documents.
* Le modÃ¨le [**ReÃ§u (v3.0)**](concept-receipt.md) prend en charge le traitement des reÃ§us dâ€™hÃ´tel dâ€™une seule page.
* Le modÃ¨le [**Document dâ€™identitÃ© (v3.0)**](concept-id-document.md) prend en charge lâ€™extraction des approbations, des restrictions et des classifications de vÃ©hicules Ã  partir de permis de conduire amÃ©ricains.
* Lâ€™[**API ModÃ¨le personnalisÃ© (v3.0)**](concept-custom.md) prend en charge la dÃ©tection de signatures pour les formulaires personnalisÃ©s.

Dans cet article, vous allez dÃ©couvrir les diffÃ©rences entre les versionsÂ 2.1 etÂ 3.0 de Form Recognizer et comment passer Ã  la version la plus rÃ©cente de lâ€™API.

## <a name="changes-to-the-rest-api-endpoints"></a>Modifications apportÃ©es aux points de terminaison de lâ€™API REST

 Lâ€™API RESTÂ v3.0 combine les opÃ©rations dâ€™analyse pour lâ€™analyse de la disposition, les modÃ¨les prÃ©dÃ©finis et les modÃ¨les personnalisÃ©s en une seule paire dâ€™opÃ©rations en assignant **`documentModels`** et **`modelId`** Ã  lâ€™analyse de la disposition (disposition prÃ©dÃ©finie) et aux modÃ¨les prÃ©dÃ©finis.

### <a name="post-request"></a>requÃªte POST

```http
https://{your-form-recognizer-endpoint}/formrecognizer/documentModels/{modelId}?api-version=2021-07-30-preview

```

### <a name="get-request"></a>RequÃªte GET

```http
https://{your-form-recognizer-endpoint}/formrecognizer/documentModels/{modelId}/AnalyzeResult/{resultId}?api-version=2021-07-30-preview
```

### <a name="analyze-operation"></a>OpÃ©ration dâ€™analyse

* La charge utile de la demande et le modÃ¨le dâ€™appel restent inchangÃ©s.
* Lâ€™opÃ©ration dâ€™analyse spÃ©cifie le document dâ€™entrÃ©e et les configurations spÃ©cifiques au contenu, et elle renvoie lâ€™URL du rÃ©sultat de lâ€™analyse via lâ€™en-tÃªte Operation-Location de la rÃ©ponse.
* Interrogez cette URL de rÃ©sultat dâ€™analyse, via une requÃªte GET, pour vÃ©rifier lâ€™Ã©tat de lâ€™opÃ©ration dâ€™analyse (lâ€™intervalle minimum recommandÃ© entre les requÃªtes est dâ€™une seconde).
* En cas de rÃ©ussite, lâ€™Ã©tat est dÃ©fini sur Â«Â succeededÂ Â» et [analyzeResult](#changes-to-analyze-result) est renvoyÃ© dans le corps de la rÃ©ponse. Si des erreurs se produisent, lâ€™Ã©tat est dÃ©fini sur Â«Â failedÂ Â» et une erreur est renvoyÃ©e.

| ModÃ¨le | v2.1 | v3.0 |
|:--| :--| :--|
| **PrÃ©fixe de lâ€™URL de la demande**| **https://{your-form-recognizer-endpoint}/formrecognizer/v2.1**  | **https://{your-form-recognizer-endpoint}/formrecognizer** |
|ğŸ†• **Document gÃ©nÃ©ral**|N/A|/documentModels/prebuilt-document:analyze |
| **Disposition**| /layout/analyze |/documentModels/prebuilt-layout:analyze|
|**PersonnalisÃ©e**| /custom/{modelId}/analyze    |/documentModels/{modelId}:analyze |
| **Facture** | /prebuilt/invoice/analyze    | /documentModels/prebuilt-invoice:analyze |
| **RÃ©ception** | /prebuilt/receipt/analyze    | /documentModels/prebuilt-receipt:analyze |
| **Document dâ€™identitÃ©** | /prebuilt/idDocument/analyze |  /documentModels/prebuilt-idDocument:analyze |
|**Carte de visite**| /prebuilt/businessCard/analyze| /documentModels/prebuilt-businessCard:analyze|

### <a name="analyze-request-body"></a>Corps de la demande dâ€™analyse

Le contenu Ã  analyser est fourni par le corps de la demande. Lâ€™URL ou les donnÃ©es codÃ©es en base64 peuvent Ãªtre utilisÃ©es pour construire la requÃªte.

  Pour spÃ©cifier une URL web accessible publiquement, dÃ©finissez Content-Type surâ€¯**application/json**â€¯et envoyez le corps JSON suivantÂ :

  ```json
  {
    "urlSource": "{urlPath}"
  }
  ```

Lâ€™encodage Base64 est Ã©galement pris en charge par Form RecognizerÂ v3.0Â :

```json
{
  "base64Source": "{base64EncodedContent}"
}
```

### <a name="additional-parameters"></a>ParamÃ¨tres supplÃ©mentaires

ParamÃ¨tres qui continuent dâ€™Ãªtre pris en chargeÂ :

* pages
* locale

ParamÃ¨tres qui ne sont plus pris en chargeÂ : 

* includeTextDetails

Le nouveau format de rÃ©ponse est plus compact et la sortie complÃ¨te est toujours renvoyÃ©e.

## <a name="changes-to-analyze-result"></a>Modifications du rÃ©sultat dâ€™analyse

Lâ€™analyse de la rÃ©ponse a Ã©tÃ© refactorisÃ©e aux rÃ©sultats de haut niveau suivants pour prendre en charge les Ã©lÃ©ments multipages.
* pages
* dans des tables
* keyValuePairs
* entities
* styles
* dans des documents

> [!NOTE]
>
> Les modifications apportÃ©es Ã  la rÃ©ponse analyzeResult incluent un certain nombre de modifications, comme le fait de passer dâ€™une propriÃ©tÃ© de pages Ã  une propriÃ©tÃ© de levier supÃ©rieur dans analyzeResult.

```json

{
// Basic analyze result metadata
"apiVersion": "2021-07-30-preview", // REST API version used
"modelId": "prebuilt-invoice", // ModelId used
"stringIndexType": "textElements", // Character unit used for string offsets and lengths:
// textElements, unicodeCodePoint, utf16CodeUnit // Concatenated content in global reading order across pages.
// Words are generally delimited by space, except CJK (Chinese, Japanese, Korean) characters.
// Lines and selection marks are generally delimited by newline character.
// Selection marks are represented in Markdown emoji syntax (:selected:, :unselected:).
"content": "CONTOSO LTD.\nINVOICE\nContoso Headquarters...", "pages": [ // List of pages analyzed
{
// Basic page metadata
"pageNumber": 1, // 1-indexed page number
"angle": 0, // Orientation of content in clockwise direction (degree)
"width": 0, // Page width
"height": 0, // Page height
"unit": "pixel", // Unit for width, height, and bounding box coordinates
"spans": [ // Parts of top-level content covered by page
{
"offset": 0, // Offset in content
"length": 7 // Length in content
}
], // List of words in page
"words": [
{
"text": "CONTOSO", // Equivalent to $.content.Substring(span.offset, span.length)
"boundingBox": [ ... ], // Position in page
"confidence": 0.99, // Extraction confidence
"span": { ... } // Part of top-level content covered by word
}, ...
], // List of selectionMarks in page
"selectionMarks": [
{
"state": "selected", // Selection state: selected, unselected
"boundingBox": [ ... ], // Position in page
"confidence": 0.95, // Extraction confidence
"span": { ... } // Part of top-level content covered by selection mark
}, ...
], // List of lines in page
"lines": [
{
"content": "CONTOSO LTD.", // Concatenated content of line (may contain both words and selectionMarks)
"boundingBox": [ ... ], // Position in page
"spans": [ ... ], // Parts of top-level content covered by line
}, ...
]
}, ...
], // List of extracted tables
"tables": [
{
"rowCount": 1, // Number of rows in table
"columnCount": 1, // Number of columns in table
"boundingRegions": [ // Bounding boxes potentially across pages covered by table
{
"pageNumber": 1, // 1-indexed page number
"boundingBox": [ ... ], // Bounding box
}
],
"spans": [ ... ], // Parts of top-level content covered by table // List of cells in table
"cells": [
{
"kind": "stub", // Cell kind: content (default), rowHeader, columnHeader, stub, description
"rowIndex": 0, // 0-indexed row position of cell
"columnIndex": 0, // 0-indexed column position of cell
"rowSpan": 1, // Number of rows spanned by cell (default=1)
"columnSpan": 1, // Number of columns spanned by cell (default=1)
"content": "SALESPERSON", // Concatenated content of cell
"boundingRegions": [ ... ], // Bounding regions covered by cell
"spans": [ ... ] // Parts of top-level content covered by cell
}, ...
]
}, ...
], // List of extracted key-value pairs
"keyValuePairs": [
{
"key": { // Extracted key
"content": "INVOICE:", // Key content
"boundingRegions": [ ... ], // Key bounding regions
"spans": [ ... ] // Key spans
},
"value": { // Extracted value corresponding to key, if any
"content": "INV-100", // Value content
"boundingRegions": [ ... ], // Value bounding regions
"spans": [ ... ] // Value spans
},
"confidence": 0.95 // Extraction confidence
}, ...
], // List of extracted entities
"entities": [
{
"category": "DateTime", // Primary entity category
"subCategory": "Date", // Secondary entity category
"content": "11/15/2019", // Entity content
"boundingRegions": [ ... ], // Entity bounding regions
"spans": [ ... ], // Entity spans
"confidence": 0.99 // Extraction confidence
}, ...
], // List of extracted styles
"styles": [
{
"isHandwritten": true, // Is content in this style handwritten?
"spans": [ ... ], // Spans covered by this style
"confidence": 0.95 // Detection confidence
}, ...
], // List of extracted documents
"documents": [
{
"docType": "prebuilt-invoice", // Classified document type (model dependent)
"boundingRegions": [ ... ], // Document bounding regions
"spans": [ ... ], // Document spans
"confidence": 0.99, // Document splitting/classification confidence // List of extracted fields
"fields": {
"VendorName": { // Field name (docType dependent)
"type": "string", // Field value type: string, number, array, object, ...
"valueString": "CONTOSO LTD.",// Normalized field value
"content": "CONTOSO LTD.", // Raw extracted field content
"boundingRegions": [ ... ], // Field bounding regions
"spans": [ ... ], // Field spans
"confidence": 0.99 // Extraction confidence
}, ...
}
}, ...
]
}



```

## <a name="build-or-train-model"></a>CrÃ©er un modÃ¨le ou effectuer lâ€™apprentissage dâ€™un modÃ¨le

Lâ€™objet de modÃ¨le fait lâ€™objet de deux mises Ã  jour dans la nouvelle APIÂ :
* ```modelId``` est dÃ©sormais une propriÃ©tÃ© qui peut Ãªtre dÃ©finie sur un modÃ¨le pour un nom lisible par lâ€™utilisateur.
* ```modelName``` a Ã©tÃ© renommÃ© en ```description```

Lâ€™opÃ©ration ```build``` est appelÃ©e pour effectuer lâ€™apprentissage dâ€™un modÃ¨le. La charge utile de la demande et le modÃ¨le dâ€™appel restent inchangÃ©s. Lâ€™opÃ©ration de gÃ©nÃ©ration spÃ©cifie le modÃ¨le et le jeu de donnÃ©es de formation, et elle renvoie le rÃ©sultat via lâ€™en-tÃªte Operation-Location dans la rÃ©ponse. Interrogez cette URL dâ€™opÃ©ration de modÃ¨le, via une requÃªte GET, pour vÃ©rifier lâ€™Ã©tat de lâ€™opÃ©ration de gÃ©nÃ©ration (lâ€™intervalle minimum recommandÃ© entre les requÃªtes est dâ€™une seconde). Contrairement Ã  la versionÂ 2.1, cette URL nâ€™est pas lâ€™emplacement de la ressource du modÃ¨le. Au lieu de cela, lâ€™URL du modÃ¨le peut Ãªtre construite Ã  partir du modelId donnÃ©, Ã©galement rÃ©cupÃ©rÃ© dans la propriÃ©tÃ© resourceLocation de la rÃ©ponse. En cas de rÃ©ussite, lâ€™Ã©tat est dÃ©fini sur ```succeeded``` et le rÃ©sultat contient les informations sur le modÃ¨le personnalisÃ©. Si des erreurs se produisent, lâ€™Ã©tat est dÃ©fini sur ```failed``` et lâ€™erreur est renvoyÃ©e.

Le code suivant est un exemple de demande de gÃ©nÃ©ration utilisant un jeton SAP. Notez la barre oblique de fin lorsque vous dÃ©finissez le prÃ©fixe ou le chemin du dossier.

```json
POST https://{your-form-recognizer-endpoint}/formrecognizer/documentModels:build?api-version=2021-09-30-preview

{
  "modelId": {modelId},
  "description": "Sample model",
  "azureBlobSource": {
    "containerUrl": "https://{storageAccount}.blob.core.windows.net/{containerName}?{sasToken}",
    "prefix": "{folderName/}"
  }
}
```
## <a name="changes-to-compose-model"></a>Modifications apportÃ©es au modÃ¨le de composition

Le modÃ¨le de composition est maintenant limitÃ© Ã  un seul niveau dâ€™imbrication. Les modÃ¨les composÃ©s sont dÃ©sormais cohÃ©rents avec les modÃ¨les personnalisÃ©s grÃ¢ce Ã  lâ€™ajout des propriÃ©tÃ©s ```modelId``` et ```description```.

```json
POST https://{your-form-recognizer-endpoint}/formrecognizer/documentModels:compose?api-version=2021-09-30-preview
{
  "modelId": "{composedModelId}",
  "description": "{composedModelDescription}",
  "componentModels": [
    { "modelId": "{modelId1}" },
    { "modelId": "{modelId2}" },
  ]
}

```

## <a name="changes-to-copy-model"></a>Modifications apportÃ©es au modÃ¨le de copie

Le modÃ¨le dâ€™appel pour le modÃ¨le de copie reste inchangÃ©Â :

* Autorisez lâ€™opÃ©ration de copie avec la ressource cible qui appelle ```authorizeCopy```. DÃ©sormais une requÃªte POST.
* Envoyez lâ€™autorisation Ã  la ressource source pour copier le modÃ¨le appelant ```copy-to```.
* Interrogez lâ€™opÃ©ration renvoyÃ©e pour valider lâ€™opÃ©ration terminÃ©e avec succÃ¨s.

Les seules modifications apportÃ©es Ã  la fonction du modÃ¨le de copie sont les suivantesÂ :

* Lâ€™action HTTP sur ```authorizeCopy``` est dÃ©sormais une requÃªte POST.
* La charge utile dâ€™autorisation contient toutes les informations nÃ©cessaires pour envoyer la demande de copie.

Autorisez la copie.
```json
POST https://{targetHost}/formrecognizer/documentModels:authorizeCopy?api-version=2021-09-30-preview
{
  "modelId": "{targetModelId}",
  "description": "{targetModelDescription}",
}
```
Utilisez le corps de rÃ©ponse de lâ€™action dâ€™autorisation pour construire la demande de copie.

```json
POST https://{sourceHost}/formrecognizer/documentModels/{sourceModelId}:copy-to?api-version=2021-09-30-preview
{
  "targetResourceId": "{targetResourceId}",
  "targetResourceRegion": "{targetResourceRegion}",
  "targetModelId": "{targetModelId}",
  "targetModelLocation": "https://{targetHost}/formrecognizer/documentModels/{targetModelId}",
  "accessToken": "{accessToken}",
  "expirationDateTime": "2021-08-02T03:56:11Z"
}
```

## <a name="changes-to-list-models"></a>Modifications apportÃ©es aux modÃ¨les de liste

Les modÃ¨les de liste ont Ã©tÃ© Ã©tendus et renvoient dÃ©sormais des modÃ¨les prÃ©dÃ©finis et personnalisÃ©s. Tous les noms de modÃ¨les prÃ©dÃ©finis commencent par ```prebuilt-```. Seuls les modÃ¨les dont lâ€™Ã©tat est rÃ©ussi sont renvoyÃ©s. Pour rÃ©pertorier les modÃ¨les qui ont Ã©chouÃ© ou qui sont en cours dâ€™utilisation, consultez la section [OpÃ©rations de liste](https://westus.dev.cognitive.microsoft.com/docs/services/form-recognizer-api-v3-0-preview-1/operations/GetModels).

Exemple de demande de modÃ¨les de liste

```json
GET https://{your-form-recognizer-endpoint}/formrecognizer/documentModels?api-version=2021-09-30-preview
```

## <a name="change-to-get-model"></a>Modifications apportÃ©es au modÃ¨le Get

Ã‰tant donnÃ© que le modÃ¨le Get comprend dÃ©sormais des modÃ¨les prÃ©dÃ©finis, lâ€™opÃ©ration Get renvoie un dictionnaire ```docTypes```. Chaque type de document est dÃ©crit par son nom, une description facultative, un schÃ©ma de champ et une confiance facultative dans le champ. Le schÃ©ma de champ dÃ©crit la liste des champs potentiellement renvoyÃ©s avec le type de document.

```json
GET https://{your-form-recognizer-endpoint}/formrecognizer/documentModels/{modelId}?api-version=2021-09-30-preview
```

## <a name="new-get-info-operation"></a>Nouvelle opÃ©ration Get info
Lâ€™opÃ©ration ```info``` sur le service renvoie le nombre de modÃ¨les personnalisÃ©s et la limite de modÃ¨les personnalisÃ©s.

```json
GET https://{your-form-recognizer-endpoint}/formrecognizer/info? api-version=2021-09-30-preview
```
Exemple de rÃ©ponse
```json
{
  "customDocumentModels": {
    "count": 5,
    "limit": 100
  }
}
```

## <a name="next-steps"></a>Ã‰tapes suivantes

Dans ce guide de migration, vous avez appris Ã  mettre Ã  niveau votre application Form Recognizer existante pour utiliser les APIÂ v3.0. Continuez Ã  utiliser lâ€™APIÂ 2.1 pour toutes les fonctionnalitÃ©s de disponibilitÃ© gÃ©nÃ©rale, et utilisez lâ€™APIÂ 3.0 pour toutes les fonctionnalitÃ©s dâ€™Ã©valuation.

* [Passer en revue la nouvelle API REST](https://westus.dev.cognitive.microsoft.com/docs/services/form-recognizer-api-v3-0-preview-1/operations/AnalyzeDocument)
* [Quâ€™est-ce que Form RecognizerÂ ?](overview.md)
* [DÃ©marrage rapide Form Recognizer](./quickstarts/try-sdk-rest-api.md)